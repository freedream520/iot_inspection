<!DOCTYPE html>
<html>
<head>
<title>问题上报</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta charset="UTF-8">
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes" />
<link rel="stylesheet" href="../../package/layui-v2.5.5/layui/css/layui.css">
<link rel="stylesheet" href="../../css/temporary_task/report.css">
<body style="background-color: #FAFDFD;margin-left:8px;margin-right:8px;width:98%;height:100%">
	<div class="layui-row layui-col-space12" style="background-color: #FAFDFD;">
		<div class="layui-col-md12" style="margin-top:20px;display:none">
			<div style="font-size:36px;text-align:center;font-weight:500;color:#666666">&nbsp待&nbsp办&nbsp任&nbsp务&nbsp列&nbsp表&nbsp</div>
		</div>
		<div class="layui-col-md11">
			<table class="layui-table" lay-filter="test" id="pending"></table>
		</div>
	</div>

	<script type="text/html" id="barDemo">
 		 <a class="layui-btn layui-btn-xs" lay-event="edit" style="font-size:13px">&nbsp&nbsp&nbsp&nbsp处&nbsp&nbsp&nbsp&nbsp理&nbsp&nbsp&nbsp&nbsp</a>
	</script>
	<script type="text/javascript" src="../../package/jquery-3.3.1/jquery-3.3.1.min.js"></script>
	<script type="text/javascript" src="../../package/layui-v2.5.5/layui/layui.js"></script>
	<script src="../../package/jquery.cookie.js"></script>

	<script type="text/javascript">
	layui.use(['layer', 'form', 'laydate', 'table'], function(){
    	//加载layui内置模块
		  var form = layui.form
		  ,layer = layui.layer
		  ,table = layui.table; //重点处,使用jQuery
		  
		  table.render({
			    elem: '#pending'
			    ,url: '/iot_inspection/temporarytask/show/list' //数据接口
			    ,where:{
			    	"executePerson": "李红芳",
			    	"page": 1,
			    	"limit": 5
			    }
			  ,parseData: function(res){ //res 即为原始返回的数据
					var data = res.data;
					
					if(data != null){
						if(data.list != null && data.list.length != 0){
							for(var i=0;i<data.list.length;i++){
								if(data.list[i].taskState === 'FINISHED'){
									data.list[i].taskState = '已完成';
								}else if(data.list[i].taskState === 'UNFINISHED'){
									data.list[i].taskState = '未完成';
								}else if(data.list[i].taskState === 'OVERFINISHED'){
									data.list[i].taskState = '超期未完成';
								}
							}
						}
					}
					
					return {
						"code": res.state,      //解析接口状态
						"msg": res.message,        //解析提示文本
						"count": data.count,   //解析数据长度
						"data": data.list      //解析数据列表
					};
			    }
		  		,skin:'line'
			    ,cols: [[ //表头
					{type:'numbers', title: '序号', align:'center', width:'9%'}
					,{field: 'taskID', title: '任务ID', align:'left', hide:true}
			      ,{field: 'taskName', title: '任务名称', align:'center', width:'22%'}
			      ,{field: 'createPerson', title: '下达人', align:'center', width:'15%'}
			      ,{field: 'requireFinishTime', title: '要求完成日期', align:'center', width:'18%'}
			      ,{field: 'taskState', title: '是否超期', align:'center', width:'18%'}
			      ,{fixed: 'right',title: '操作', width: '18%', align:'center', toolbar: '#barDemo'}
			    ]]
		  });
		  
		 //监听行工具事件
		  table.on('tool(test)', function(obj){ //注：tool 是工具条事件名，test 是 table 原始容器的属性 lay-filter="对应的值"
		    var data = obj.data //获得当前行数据
		    ,layEvent = obj.event; //获得 lay-event 对应的值
		    if(layEvent === 'edit'){
		    	//根据属地判断跳转页面

				location.href="/iot_inspection/html/temporary_task/temporary_task_handle.html?taskID="+data.taskID;
		    }
		  });  
		  
		  window.addEventListener('message', function(e) {
		        var data = JSON.parse(e.data);
		        console.log("11111111");
		        console.log(data);
		        if (data) {
		        	//需要的基本信息写入cookie
		        	$.cookie('name',data.name);
		        	$.cookie('organ',data.organ);
		        }
		        
		        table.render({
				    elem: '#pending'
				    ,url: '/iot_inspection/temporarytask/show/list' //数据接口
				    ,where:{
				    	"executePerson": "李红芳"
				    }
				  ,parseData: function(res){ //res 即为原始返回的数据
						var data = res.data;
						
						if(data != null){
							if(data.list != null && data.list.length != 0){
								for(var i=0;i<data.list.length;i++){
									if(data.list[i].taskState === 'FINISHED'){
										data.list[i].taskState = '已完成';
									}else if(data.list[i].taskState === 'UNFINISHED'){
										data.list[i].taskState = '未完成';
									}else if(data.list[i].taskState === 'OVERFINISHED'){
										data.list[i].taskState = '超期未完成';
									}
								}
							}
						}
						
						return {
							"code": res.state,      //解析接口状态
							"msg": res.message,        //解析提示文本
							"count": data.count,   //解析数据长度
							"data": data.list      //解析数据列表
						};
				    }
			  		,skin:'line'
				    ,cols: [[ //表头
						{type:'numbers', title: '序号',width:'9%'}
						,{field: 'taskID', title: '任务ID', hide:true}
				      ,{field: 'taskName', title: '任务名称',width:'23%'}
				      ,{field: 'createPerson', title: '上报人',width:'15%'}
				      ,{field: 'requireFinishTime', title: '要求完成日期',width:'18%'}
				      ,{field: 'taskState', title: '是否超期',width:'15%'}
				      ,{fixed: 'right',title: '操作', width: '20%', align:'center', toolbar: '#barDemo'}
				    ]]
			  });
		        
			  //监听行工具事件
			  table.on('tool(test)', function(obj){ //注：tool 是工具条事件名，test 是 table 原始容器的属性 lay-filter="对应的值"
			    var data = obj.data //获得当前行数据
			    ,layEvent = obj.event; //获得 lay-event 对应的值
			    if(layEvent === 'edit'){
			    	//根据属地判断跳转页面

					location.href="/iot_inspection/html/temporary_task/temporary_task_handle.html?taskID="+data.taskID;
			    }
			  });  
		    }, false); 
  })
</script>
</body>
</html>
